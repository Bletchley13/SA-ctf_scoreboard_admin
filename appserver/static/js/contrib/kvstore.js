define(["require","jquery","underscore","backbone","splunkjs/mvc/utils","util/splunkd_utils"],function(b,d,a){var e=b("jquery");var h=b("underscore");var g=b("backbone");var c=b("splunkjs/mvc/utils");var k=b("util/splunkd_utils");var j="nobody";d={};function i(){return{owner:j,app:c.getCurrentApp()}}function f(l,m){m=m||{};return k.fullpath("storage/collections/data/"+encodeURI(l),{owner:m.owner||j,app:m.app||c.getCurrentApp()})}d.Model=g.Model.extend({defaults:{_user:"nobody"},idAttribute:"_key",collectionName:null,namespace:i,initialize:function(l,m){if(m){if(m.isNew){this._isNew=true}var n=m.namespace;if(m.collection&&m.collection.namespace){n=h.extend(n||{},m.collection.namespace)}if(!h.isUndefined(n)){this.namespace=h.clone(n);if(!h.isUndefined(this.namespace.owner)){this.set("_user",this.namespace.owner)}}}return g.Model.prototype.initialize.apply(this,arguments)},isNew:function(l){if(!h.isUndefined(l)){if(l){this._isNew=true}else{delete this._isNew}}if(this._isNew){return true}else{return g.Model.prototype.isNew.apply(this,arguments)}},urlRoot:function(){return f(this.collectionName,h.result(this,"namespace"))},save:function(o,p,n){if(this.id===""){return e.Deferred().reject(null,null,new Error("Model with empty string as a _key cannot be saved"))}var m;if(o==null||typeof o==="object"){m=o;n=p}else{(m={})[o]=p}if(!this.isNew()&&!this._isNew){n=h.extend({type:"POST"},n)}if(this._isNew){this._isNew=true;n=h.clone(n)||{};var l=this;var q=n.success;n.success=function(){l.isNew(false);if(q){q.apply(this,arguments)}}}return g.Model.prototype.save.call(this,m,n)},destroy:function(l){if(this.id===""){return e.Deferred().reject(null,null,new Error("Model with empty string as a _key cannot be destroyed"))}var m;if(!l||!l.dataType){m={dataType:"text"};if(l){m=h.extend(m,l)}}else{m=l}return g.Model.prototype.destroy.call(this,m)},fetch:function(){if(this.id===""){return e.Deferred().reject(null,null,new Error("Model with empty string as a _key cannot be fetched"))}return g.Model.prototype.fetch.apply(this,arguments)}});d.Collection=g.Collection.extend({collectionName:null,namespace:i,initialize:function(m,l){if(l){if(!h.isUndefined(l.namespace)){this.namespace=h.clone(l.namespace)}}return g.Collection.prototype.initialize.apply(this,arguments)},url:function(){return f(this.collectionName,h.result(this,"namespace"))}});return d});